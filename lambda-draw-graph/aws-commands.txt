
;; CREATE (and upload) the lambda function
;; note: 'fileb' for binary files. use file for text

aws lambda create-function \
--function-name DrawGraph \
--runtime java8 \
--memory-size 1024 \
--timeout 59 \
--description 'converts a graph in either CSV1 or  JGF formats to graphviz dot format' \
--role arn:aws:iam::948737168603:role/basic_lambda_role \
--handler clojurehandler.Handler::handleRequest \
--zip-file fileb://target/lambda-draw-graph-0.1.0-standalone.jar \
--layers arn:aws:lambda:eu-west-2:948737168603:layer:dot:2 \
--region eu-west-2


;; DELETE the function
aws lambda delete-function \
--function-name DrawGraph 

;; UPDATE the function's code
aws lambda update-function-code \
--function-name DrawGraph \
--zip-file fileb://target/lambda-draw-graph-0.1.0-standalone.jar


;; INVOKE the function

aws lambda invoke \
--function-name DrawGraph \
--payload fileb://input_csv1.json \
out_from_csv1.json



curl -v -X POST \
  'https://bshpej4c0c.execute-api.eu-west-2.amazonaws.com/test' \
  -H 'content-type: application/json' \
  -d '{"data":"id\n0,A\nA,1",
"display-options" : {"hide-leaves?" : false, "show-roots?" : true, "cluster-on" : "hierarchy", "layout" : "dot", "label" : "id", "dpi" : 72},
"format-in" : "csv",
"format-out" : "svg"}'
