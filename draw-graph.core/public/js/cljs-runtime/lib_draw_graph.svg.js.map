{"version":3,"sources":["lib_draw_graph/svg.cljc"],"mappings":"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","names":["this__4428__auto__","writer__4429__auto__","opt__4430__auto__","cljs.core/-write","lib-draw-graph.svg/xy","lib-draw-graph.svg/->xy","x","y","this","x__4487__auto__","m__4488__auto__","lib-draw-graph.svg/add","goog/typeOf","m__4485__auto__","cljs.core/missing-protocol","lib-draw-graph.svg/Geom","that","cljs.core/PROTOCOL_SENTINEL","x-sum","y-sum","var_args","args__4795__auto__","len__4789__auto__","i__4790__auto__","argseq__4796__auto__","cljs.core/IndexedSeq","lib-draw-graph.svg/xs","seq37331","self__4777__auto__","cljs.core/seq","xys","p1__37330#","cljs.core.map","lib-draw-graph.svg/ys","seq37340","p1__37339#","lib-draw-graph.svg/str-pair->xy","pair","cljs.reader.read_string","cljs.core/first","cljs.core/second","lib-draw-graph.svg/str->num","s","lib-draw-graph.svg/regex-number","lib-draw-graph.svg/whitespace","instaparse.core/parser","instaparse.core.parser","lib-draw-graph.svg/path-parser","lib-draw-graph.svg/parse-path","G__37359","G__37360","instaparse.core/transform","args","cljs.core.partition","cljs.core.mapv","c","cljs.core/flatten","lib-draw-graph.svg/points-parser","lib-draw-graph.svg/parse-polygon","G__37369","G__37370","lib-draw-graph.svg/viewbox-parser","lib-draw-graph.svg/parse-viewbox","G__37371","G__37372","cljs.core.drop","lib-draw-graph.svg/transform-parser","lib-draw-graph.svg/parse-transform","G__37373","G__37374","arg","cljs.core.apply","cljs.core/merge","lib-draw-graph.svg/polygon->bounding-box","pts","xs","ys","min-x","cljs.core/min","min-y","max-x","cljs.core/max","max-y","lib-draw-graph.svg/path->bounding-box","path","collected","item","cljs.core/map?","p1__37376#","points","cljs.core/vals","cljs.core.conj","cljs.core/sequential?","p1__37378#","n","x__4273__auto__","y__4274__auto__","bdg","radius","abs","cljs.core.assoc","lib-draw-graph.svg/svg","lib-draw-graph.svg/g","lib-draw-graph.svg/title","lib-draw-graph.svg/polygon","lib-draw-graph.svg/path","lib-draw-graph.svg/text","lib-draw-graph.svg/ellipse","lib-draw-graph.svg/circle","js/lib-draw-graph","js/lib-draw-graph.svg","js/lib-draw-graph.svg.bounding-box","method-table__4672__auto__","cljs.core.atom","prefer-table__4673__auto__","method-cache__4674__auto__","cached-hierarchy__4675__auto__","hierarchy__4676__auto__","cljs.core.get","fexpr__37432","cljs.core/MultiFn","cljs.core.symbol","lib-draw-graph.svg/bounding-box","svg","attrs","flo","js/parseFloat","cx","cy","rx","ry","r","lib-draw-graph.svg/box->rect","m","cljs.core.dissoc","lib-draw-graph.svg/all-clusters","loc","cljs.core._EQ_","clojure.zip/node","lib-draw-graph.svg/cluster","cluster","content","cljs.core/List","lib-draw-graph.svg/graph","lib-draw-graph.svg/the-svg","lib-draw-graph.svg/all-nodes","lib-draw-graph.svg/jump","num-locs","cljs.core.nth","cljs.core/iterate","clojure.zip/next","clojure.zip/prev","lib-draw-graph.svg/node","node","parts","clojure.string.split","raw-node","clojure.string/replace","num-parts","cljs.core/count","jumps","cljs.core.take","cljs.core.partial","cljs.core/+","get-part","first-part","contents","clojure.string.join","cljs.core/cons","iter__4582__auto__","s__37451","cljs.core/LazySeq","temp__5735__auto__","cljs.core/chunked-seq?","c__4580__auto__","size__4581__auto__","b__37453","cljs.core/chunk-buffer","i__37452","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__37450","cljs.core/chunk-rest","cljs.core/rest","lib-draw-graph.svg/parse-svg","clojure.data.xml/parse-str","lib-draw-graph.svg/->zipper","xml","clojure.zip/xml-zip","lib-draw-graph.svg/wrong-svg-header","lib-draw-graph.svg/right-svg-header","lib-draw-graph.svg/wrong-xlink","lib-draw-graph.svg/relic-ns","lib-draw-graph.svg/->xml","parsed","raw","clojure.data.xml/emit-str","fixed","fixed2","fixed3","G__37456","lib-draw-graph.svg/tree-find","js/Error","zipper","match-pred","lib_draw_graph.svg.tree_find","cljs.core/identity","shift","nodes","clojure.zip/end?","temp__5733__auto__","matcher-result","lib-draw-graph.svg/canvas","viewbox","transform","lib-draw-graph.svg/set-canvas","vbx","vby","clojure.zip/root","clojure.zip.edit","cljs.core/assoc","lib-draw-graph.svg/just-the-node","lib-draw-graph.svg/cluster->rect","clstr","e37480","e","lib-draw-graph.util/err","lib-draw-graph.svg/node->rect","nd","e37484","lib-draw-graph.svg/c","turn","-radius","half-r","-half-r","curve","G__37492","cljs.core/Keyword","cljs.core/str","cljs.core.interpose","lib-draw-graph.svg/l","lib-draw-graph.svg/rect-poly","start","width","height","-height","lib-draw-graph.svg/rect->poly","lib-draw-graph.svg/rounded-rect","h","w","-h","-w","js/lib-draw-graph.svg.rect->svg","fexpr__37495","lib-draw-graph.svg/rect->svg","G__37497","lib-draw-graph.svg/tree-edit","matcher","editor","lib_draw_graph.svg.tree_edit","k-shift","get-k","d-shift","k","G__37498","new-loc","clojure.zip/edit","lib-draw-graph.svg/->root","p","clojure.zip/up","lib-draw-graph.svg/->node","cljs.core/chunk-first"],"sourcesContent":["(ns ^{:doc \"Svg processing.\"\n      :author \"Jude Payne\"}\n    lib-draw-graph.svg\n  (:require [clojure.zip           :as zip]\n            [clojure.data.zip.xml  :refer [xml-> xml1-> attr attr= text= tag=]]\n            [clojure.data.xml      :as xml]\n            [lib-draw-graph.util   :as util]\n            #?(:clj [instaparse.core :as insta :refer [defparser]]\n               :cljs [instaparse.core :as insta :refer-macros [defparser]])))\n\n\n;; -----------------\n;; Simple type to express either an x,y point or translation\n(deftype xy [^Long x ^Long y]\n  Object\n  (toString [this]\n    (str #?(:clj (.x this) :cljs (.-x this))\n         \",\"\n         #?(:clj (.y this) :cljs (.-y this)))))\n\n\n(defprotocol Geom\n  (add [^xy this ^xy that]))\n\n\n(extend-type xy\n  Geom\n  (add [this that]\n    (let [x-sum (+ #?(:clj (.x this) :cljs (.-x this))\n                   #?(:clj (.x that) :cljs (.-x that)))\n          y-sum (+ #?(:clj (.y this) :cljs (.-y this))\n                   #?(:clj (.y that) :cljs (.-y that)))]\n      (xy. x-sum y-sum))))\n\n\n(defn xs\n  \"Returns the x components of the xys\"\n  [& xys]\n  #?(:clj (map #(.x %) xys)\n     :cljs (map #(.-x %) xys)))\n\n\n(defn ys\n  \"Returns the y components of the xys\"\n  [& xys]\n  #?(:clj (map #(.y %) xys)\n     :cljs (map #(.-y %) xys)))\n\n\n(defn str-pair->xy [pair]\n  #?(:clj (xy. (util/parse-float (first pair))\n               (util/parse-float (second pair)))\n     :cljs (xy. (cljs.reader/read-string (first pair))\n                (cljs.reader/read-string (second pair)))))\n\n\n(defn str->num [s]\n  #?(:clj (util/parse-float s)\n     :cljs (cljs.reader/read-string s)))               \n\n;; -----------------\n;; READING SVG\n\n(def regex-number \"#'-?[0-9]\\\\d*(\\\\.\\\\d+)?'\")\n\n\n(def whitespace\n  (insta/parser\n    \"whitespace = #'\\\\s+'\"))\n\n\n(defparser path-parser\n  (str\n   \"S = M? C?\n    M = <'M'>P\n    C = <'C'>Ns+\n    <Ns> = P P P\n    <P> = N Comma N\n    <Comma> = <','>\n    <N> = \" regex-number)\n  :auto-whitespace whitespace)\n\n\n(defn parse-path [s]\n  (insta/transform\n   {:M (fn [& args] {:M (str-pair->xy args)})\n    :C (fn [& args] \n         (->> args\n              (partition 2)\n              (mapv str-pair->xy)\n              (partition 3)\n              (map (fn [c] {:C c}))))\n    :S (fn [& args] (flatten args))}\n   (path-parser s)))\n\n\n(defparser points-parser\n  (str\n   \"S = P+\n    <P> = N Comma N\n    <Comma> = <','>\n    <N> = \" regex-number)\n  :auto-whitespace whitespace)\n\n\n(defn parse-polygon [s]\n  (insta/transform\n   {:S (fn [& args]\n         (->> args\n              (partition 2)\n              (mapv str-pair->xy)))}\n   (points-parser s)))\n\n\n(defparser viewbox-parser\n  (str\n   \"S = N+\n  <N> = \" regex-number)\n  :auto-whitespace whitespace)\n\n\n(defn parse-viewbox [s]\n  (insta/transform\n   {:S (fn [& args] (drop 2 (map str->num args)))}\n   (viewbox-parser s)))\n\n\n(defparser transform-parser\n  (str\n   \"S = SCALE ROTATE TRANSLATE\n   SCALE = <'scale('> N+ <')'>\n   ROTATE = <'rotate('> N <')'>\n   TRANSLATE = <'translate('> N+ <')'>\n   <N> = \" regex-number)\n  :auto-whitespace whitespace)\n\n\n(defn parse-transform [s]\n  (insta/transform\n   {:SCALE (fn [& args] {:scale (map str->num args)})\n    :ROTATE (fn [arg] {:rotate (str->num arg)})\n    :TRANSLATE (fn [& args] {:translate (map str->num args)})\n    :S (fn [& args] (apply merge args))}\n   (transform-parser s)))\n\n\n(defn polygon->bounding-box\n  \"Returns the bounding box of the points.\n  pts should be a collection of xy's\"\n  [pts]\n  (let [xs  (apply xs pts)\n        ys  (apply ys pts)\n        min-x (apply min xs)\n        min-y (apply min ys)\n        max-x (apply max xs)\n        max-y (apply max ys)]\n    {:left min-x :bottom max-y :right max-x :top min-y}))\n\n\n(defn path->bounding-box [path]\n    (letfn [(points [collected item]\n              (cond\n                (map? item)          (map #(points collected %) (vals item))\n                (instance? xy item)  (conj collected item)\n                (sequential? item)   (map #(points collected %) item)))\n            (abs [n] (max n (- n)))]\n      (let [pts (flatten (points [] path))\n            xs (apply xs pts)\n            ys (apply ys pts)\n            bdg (polygon->bounding-box pts)\n            radius (abs (- (:left bdg)\n                           #?(:clj (.x (first pts))\n                              :cljs (.-x (first pts)))))]\n        (assoc bdg :radius radius))))\n\n\n(def svg :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/svg)\n;; 11 nexts between two subsequent cluster g's\n(def g :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/g)\n;; 2 previous\n(def title :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/title)\n;; 3 previous\n(def polygon :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/polygon)\n;; *or*\n(def path :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/path)\n;; 2 previous\n(def text :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/text) ;<- where we find\n; content (\"squirrels\") or whatever\n(def ellipse :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/ellipse)\n\n(def circle :xmlns.http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg/circle)\n\n\n(defmulti bounding-box\n  \"Takes in a chunk of svg and returns a map specifying the bounding rectangle.\"\n  (fn [svg] (:tag svg)))\n\n\n(defmethod bounding-box polygon [svg]\n  (-> svg\n      :attrs\n      :points\n      parse-polygon\n      polygon->bounding-box))\n\n\n(defmethod bounding-box path [svg]\n  (-> svg\n      :attrs\n      :d\n      parse-path\n      path->bounding-box))\n\n\n(defmethod bounding-box ellipse [svg]\n  (let [attrs (-> svg :attrs)\n        flo (fn [s] #?(:clj (Float/parseFloat s) :cljs (js/parseFloat s)))\n        cx (flo (:cx attrs))\n        cy (flo (:cy attrs))\n        rx (flo (:rx attrs))\n        ry (flo (:ry attrs))]\n    {:left (- cx rx)\n     :right (+ cx rx)\n     :top (- cy ry)\n     :bottom (+ cy ry)}))\n\n\n(defmethod bounding-box circle [svg]\n  (let [attrs (-> svg :attrs)\n        flo (fn [s] #?(:clj (Float/parseFloat s) :cljs (js/parseFloat s)))\n        cx (flo (:cx attrs))\n        cy (flo (:cy attrs))\n        r (flo (:r attrs))]\n    {:left (- cx r)\n     :right (+ cx r)\n     :top (- cy r)\n     :bottom (+ cy r)}))\n\n\n(defn box->rect\n  \"Converts a bounding box map produced into :x :y :w :h form.\"\n  [m]\n  (-> m\n      (dissoc :bottom :top :right :left)\n      (assoc :x (int (:left m)))\n      (assoc :y (int (:top m)))\n      (assoc :w (int (- (:right m) (:left m))))\n      (assoc :h (int (- (:bottom m) (:top m))))))\n\n\n(defn all-clusters [loc]\n  (= \"cluster\" (:class (:attrs (zip/node loc)))))\n\n\n(defn cluster [cluster loc]\n  (let [content (:content (zip/node loc))]\n    (= content (list cluster))))\n\n\n(defn graph [loc]\n  (= \"graph\" (:class (:attrs (zip/node loc)))))\n\n\n(defn the-svg [loc]\n  (= svg (:tag (zip/node loc))))\n\n\n(defn all-nodes [loc]\n  (= \"node\" (:class (:attrs (zip/node loc)))))\n\n\n(defn jump \n  \"For moving to prev for next locations in a zipper. num-locs\n   should be positive for next and negative for previous.\"\n  [num-locs loc]\n  (cond\n    (> num-locs 0) (nth (iterate zip/next loc) num-locs)\n    (< num-locs 0) (nth (iterate zip/prev loc) (- num-locs))\n    0 loc))\n\n\n(defn node\n  \"Matches the text of a node, including accomodating text split\n   with the special '+' characters.\"\n  [node loc]\n  (let [parts (clojure.string/split node #\"\\+\")\n        raw-node (clojure.string/replace node #\"\\+\" \"\")\n        num-parts (count parts)\n        jumps (take (dec num-parts) (iterate (partial + 3) 3))\n        get-part (fn [loc] (first (:content (zip/node loc))))\n        first-part (get-part loc)\n        contents (clojure.string/join\n                  (cons first-part\n                        (for [x jumps\n                              :let [y (get-part (jump x loc))]]\n                          y)))]\n    (= raw-node contents)))\n\n\n;; Zippers for parsing the main svg tree.\n\n(defn parse-svg [svg]\n  (-> svg\n      xml/parse-str))\n\n\n(defn ->zipper [xml]\n  (zip/xml-zip xml))\n\n\n;; set up regexes and replacement strings to fix clojurescript's emit-str\n(def wrong-svg-header #\"xmlns=\\\"http://www.w3.org/2000/svg\\\"\")\n(def right-svg-header \"xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"\")\n(def wrong-xlink #\"xmlns:ns\\d+=\\\"http://www.w3.org/1999/xlink\\\" ns\\d+\")\n(def relic-ns #\"ns\\d+:\")\n\n\n(defn ->xml [parsed]\n  #?(:clj (xml/emit-str parsed)\n     :cljs (let [raw (xml/emit-str parsed)\n                 fixed (clojure.string/replace raw wrong-xlink \"xlink\")\n                 fixed2 (clojure.string/replace fixed relic-ns \"xlink:\")\n                 fixed3 (clojure.string/replace fixed2 wrong-svg-header right-svg-header)]\n             fixed3)))\n\n\n(defn tree-find\n  \"Returns a vector of all matching nodes in the zipper.\n   match-pred is a predicate used to match each node. jump is\n   a function that takes a loc and returns another loc in the zipper.\n   i.e. a certain 'jump' away from each of the matched nodes.\n\n   Example usage:\n     (tree-find z (partial cluster \\\"pandas\\\") -2)\n   will return all nodes in the zipper z which are two locs previous\n   to the nodes matched by the function (partial cluster \\\"pandas\\\")\"\n  ([zipper match-pred]\n   (tree-find zipper match-pred identity))\n  ([zipper match-pred shift]\n   (loop [loc zipper nodes []]\n     (if (zip/end? loc)\n       nodes\n       (if-let [matcher-result (match-pred loc)]\n         (recur (zip/next loc) (conj nodes (zip/node (jump shift loc))))\n         (recur (zip/next loc) nodes))))))\n\n\n(defn canvas [zipper]\n  (let [viewbox (:viewBox (:attrs (zip/node zipper)))\n        transform (:transform (:attrs (zip/node (zip/next (zip/next zipper)))))]\n    {:viewbox (parse-viewbox viewbox)\n     :transform (parse-transform transform)}))\n\n\n(defn set-canvas [zipper vbx vby]\n  (zip/root (zip/edit zipper\n                      assoc\n                      :attrs\n                      {:width (str vbx \"pt\")\n                       :height (str vby \"pt\")\n                       :viewBox (str \"0.00 0.00 \" vbx \" \" vby)})))\n\n\n(defn just-the-node [zipper]\n  (zip/node zipper))\n\n\n(defn cluster->rect [zipper clstr]\n  (try\n    (-> (tree-find zipper (partial cluster clstr) -2)\n        first\n        bounding-box\n        (assoc :name clstr)\n        box->rect)\n    #?(:clj (catch Exception e\n              (throw (util/err\n                      (str \"Post-processing error: Could not find cluster \" clstr\n                           \" in the initial svg\"))))\n         :cljs (catch js/Error e\n                 (throw (util/err\n                         (str \"Post-processing error: Could not find cluster \" clstr\n                              \" in the initial svg\")))))))\n\n\n(defn node->rect [zipper nd]\n  (try\n    (-> (tree-find zipper (partial node nd) -2)\n        first\n        bounding-box\n        (assoc :name nd)\n        box->rect)\n    #?(:clj (catch Exception e\n              (throw (util/err\n                      (str \"Post-processing error: Could not find node \" nd\n                           \" in the initial svg\"))))\n         :cljs (catch js/Error e\n                 (throw (util/err\n                         (str \"Post-processing error: Could not find node \" nd\n                              \" in the initial svg\")))))))\n\n\n;; -----------------\n;; WRITING SVG\n\n;; Generate various svg strings for shapes - to be used in replacing\n;; parts of the svg tree below\n\n;; Note - I've chosen to use svg relative commands, c & l (not C&L) as easier to\n;; handle but the trade-off is that rounded-rect won't be identically\n;; specified in svg to the way Graphviz does it, meaning no double passes.\n;; Better get it right first time then!\n\n(defn c\n  \"Generates a bezier. assumes we are moving anti-clockwise.\n   This replicates the way Grpahviz generate a 90 deg bezier.\"\n  [radius turn]\n  (let [-radius (* -1 radius)\n        half-r  (/ radius 2)\n        -half-r (* -1 half-r)\n        curve\n        (case turn\n          :down  [-half-r 0 -radius half-r -radius radius]\n          :left  [0 -half-r -half-r -radius -radius -radius]\n          :up    [half-r 0 radius -half-r radius -radius]\n          :right [0 half-r half-r radius radius radius])]\n    (apply str \"c \"\n           (->> curve\n                (interpose \" \")))))\n\n\n(defn l [x y]\n  (str \"l \" (xy. x y)))\n\n\n(defn rect-poly\n  \"Generate the svg points string for a rectangular polygon.\n  start is an xy (point) at the bottom left of the rectangle.\"\n  [start width height]\n  (let [-height (* -1 height)]\n    (apply str\n           (interpose \" \"\n                      [start\n                       (add start (xy. 0 height))\n                       (add start (xy. width height))\n                       (add start (xy. width 0))\n                       start]))))\n\n(defn rect->poly [r]\n  (rect-poly (xy. (:x r) (:y r)) (:w r) (:h r)))\n\n\n(defn rounded-rect\n  \"Start point is bottom left (right of the curve). We move anti-\n  clockwise around the polygon.\"\n  [start width height radius]\n  (let [h (- height (* 2 radius))\n        w (- width (* 2 radius))\n        -h (* -1 h)\n        -w (* -1 w)]\n    (apply str\n           (interpose \" \"\n                      [\"M\" (add start (xy. radius height))\n                       (l w 0)\n                       (c radius :up)\n                       (l 0 -h)\n                       (c radius :left)\n                       (l -w 0)\n                       (c radius :down)\n                       (l 0 h)\n                       (c radius :right)]))))\n\n\n(defmulti rect->svg (fn [r] (some? (:radius r))))\n\n\n(defmethod rect->svg false [r]\n  (let [points (rect-poly (xy. (:x r) (:y r)) (:w r) (:h r))]\n    [:points points]))\n\n\n(defmethod rect->svg true [r]\n  (let [points (rounded-rect (xy. (:x r) (:y r)) (:w r) (:h r) (:radius r))]\n    [:d points]))\n\n\n(defn tree-edit\n  \"Take a zipper, a function that matches a pattern in the tree,\n   and a function that edits the current location in the tree.  Examine the tree\n   nodes in depth-first order, determine whether the matcher matches, and if so\n   apply the editor.\n   k-shift is the jump (from match) to get to the loc where get-k is applied to\n   extract the key.\n   d-shift is the jump (from match) to get to the loc where the data to be edited sits.\"\n  ([zipper matcher editor]\n   (tree-edit zipper matcher 0 identity 0 editor))\n  ([zipper matcher k-shift get-k d-shift editor]\n   (loop [loc zipper]\n     (if (zip/end? loc)\n       (zip/root loc)\n       (if (matcher loc)\n         (let [k (get-k (zip/node (jump k-shift loc)))\n               new-loc  (zip/edit (jump d-shift loc) (partial editor k))]\n           (recur (zip/next (jump (- d-shift) new-loc))))\n         (recur (zip/next loc)))))))\n\n;; notes  jumps are 7 to content then -2 to get attr then (obviously -5)\n\n\n(defn ->root\n  \"zips all the way up and returns the root node, reflecting any\n changes.\"\n  {:added \"1.0\"}\n  [loc]\n    (if (zip/end? loc)\n      loc\n      (let [p (zip/up loc)]\n        (if p\n          (recur p)\n          loc))))\n\n\n(defn ->node\n  [loc]\n  (zip/node loc))\n\n"]}