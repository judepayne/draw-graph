{"version":3,"sources":["draw_graph/ip.cljs"],"mappings":";;;;;;AAQA,AAAA,AAAMA,AAAUC;AAAhB,AACE,AAAAC,AACkB,AAACU,AAAQ,AAAA,AAAA,AAACC,AAAoBZ,AAC1B,AAAKa;AAAL,AAAQ,AAAAC,AAAC,AAACC,AAAQF;AAAV,AAAA,AAAAC,AAAAA,AAAA,AAAAA,AAAA;AAF9B,AAAAZ;AAAA,AAAA,AAAAC,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAAiBM;AAAjB,AAAAF,AAAAJ,AAAA,AAAwBO;AAAxB,AAAA,AAAAF,AAAA,AAGQE;;;AAIV,AAAA,AAAKM;AAGL,AAAA,AAAMC,AAAgBC;AAAtB,AACE,AAACC,AAAM,AAAA,AAACC,AAAqBF;;AAG/B,AAAA,AAAMG,AAAQC,AAAQC;AAAtB,AACO,AAACxB,AAASiB,AACV,AAACQ,AAAMC,AACP,AAAA,AAACD,AACD,AAACA,AAAMP,AACP,AAACO,AAAMF,AACP,AAACI,AAAQH","names":["draw-graph.ip/rest-get","url","promesa.core/bind","p__37744","map__37745","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","promesa.core/promise","status","body","promesa.core.catch$","kvlt.core/request!","e","fexpr__37743","cljs.core/ex-data","draw-graph.ip/ip-api-url","draw-graph.ip/extract-region","s","cljs.core/first","clojure.string.split","draw-graph.ip/region","handler","error-fn","promesa.core/map","draw-graph.utils/json->clj","promesa.core.error"],"sourcesContent":["(ns draw-graph.ip\n  (:require\n   [kvlt.core                :as kvlt]\n   [promesa.core             :as p]\n   [promesa.async-cljs :refer-macros [async]]\n   [draw-graph.utils         :as utils]))\n\n\n(defn rest-get [url]\n  (p/alet [{:keys [status body]}\n           (p/await (p/catch (kvlt/request! {:url url})\n                        (fn [e] ((ex-data e) :type))))]\n          body))\n\n\n;; remember this blocks/ bans if more than 100 requests per min from the same ip\n(def ip-api-url \"http://ip-api.com/json/\")\n\n\n(defn extract-region [s]\n  (first (clojure.string/split s #\"/\")))\n\n\n(defn region [handler error-fn]\n  (->> (rest-get ip-api-url)\n       (p/map utils/json->clj)\n       (p/map :timezone)\n       (p/map extract-region)\n       (p/map handler)\n       (p/error error-fn)))\n"]}