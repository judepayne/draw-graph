{"version":3,"sources":["kvlt/util.cljc"],"mappings":"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","names":["kvlt.util/map-keys","f","m","cljs.core.into.cljs$core$IFn$_invoke$arity$2","iter__4523__auto__","s__37038","cljs.core/LazySeq","temp__5720__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4521__auto__","size__4522__auto__","cljs.core/count","b__37040","cljs.core/chunk-buffer","i__37039","vec__37041","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__37037","cljs.core/chunk-rest","vec__37044","cljs.core/first","cljs.core/cons","cljs.core/rest","k","v","kvlt.util/map-vals","s__37049","b__37051","i__37050","vec__37052","iter__37048","vec__37055","+none+","var_args","args__4736__auto__","len__4730__auto__","i__4731__auto__","argseq__4737__auto__","cljs.core/IndexedSeq","kvlt.util/update-when","seq37058","G__37059","cljs.core/next","G__37060","G__37061","self__4717__auto__","key","args","found","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.core.apply.cljs$core$IFn$_invoke$arity$3","kvlt.util/bidirectional-chan","p__37067","vec__37068","map__37071","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","cljs.core.get.cljs$core$IFn$_invoke$arity$3","seq37062","G__37063","G__37064","read-ch","write-ch","on-close","close?","js/kvlt","js/kvlt.util","js/kvlt.util.t_kvlt$util37073","kvlt.util/t_kvlt$util37073","_37075","meta37074","this__4374__auto__","writer__4375__auto__","opt__4376__auto__","cljs.core/-write","kvlt.util/->t_kvlt$util37073","_","handler","cljs.core.async.impl.protocols/take!","msg","cljs.core.async.impl.protocols/put!","cljs.core.async.impl.protocols/close!","kvlt.util/read-proxy-chan","p__37090","vec__37092","map__37095","seq37084","G__37085","G__37086","js/kvlt.util.t_kvlt$util37098","kvlt.util/t_kvlt$util37098","_37100","meta37099","kvlt.util/->t_kvlt$util37098","kvlt.util/pprint-str","x","clojure.string/trimr","sb__4661__auto__","goog.string/StringBuffer","*print-newline*-orig-val__37111","cljs.core/*print-newline*","*print-fn*-orig-val__37112","cljs.core/*print-fn*","*print-newline*-temp-val__37113","*print-fn*-temp-val__37114","x__4662__auto__","cljs.pprint.pprint.cljs$core$IFn$_invoke$arity$1","kvlt.util/doc-examples!","vvar","examples","cljs.core.alter_meta_BANG_.cljs$core$IFn$_invoke$arity$variadic","cljs.core/update","cljs.core/str","clojure.string.join.cljs$core$IFn$_invoke$arity$2","s__37117","b__37119","i__37118","vec__37122","iter__37116","vec__37126","before","after","G__37125","G__37129","cljs.core/chunk-first"],"sourcesContent":["(ns ^:no-doc kvlt.util\n  (:require\n   [clojure.string :as str]\n   #? (:clj  [clojure.core.async.impl.protocols :as p]\n       :cljs [cljs.core.async.impl.protocols :as p])\n   #? (:clj  [clojure.pprint :as pprint]\n       :cljs [cljs.pprint :as pprint]))\n  #? (:cljs (:require-macros [kvlt.util])))\n\n(defn map-keys [f m]\n  (into {} (for [[k v] m] [(f k) v])))\n\n(defn map-vals [f m]\n  (into {} (for [[k v] m] [k (f v)])))\n\n;; Taken from Plumbing\n(let [+none+ ::none]\n  (defn update-when [m key f & args]\n    (let [found (m key +none+)]\n      (if-not (identical? +none+ found)\n        (assoc m key (apply f found args))\n        m))))\n\n;; Taken from Chord, more or less\n(defn bidirectional-chan\n  [read-ch write-ch & [{:keys [on-close close?] :or {close? true}}]]\n  (reify\n    p/ReadPort\n    (take! [_ handler]\n      (p/take! read-ch handler))\n\n    p/WritePort\n    (put! [_ msg handler]\n      (p/put! write-ch msg handler))\n\n    p/Channel\n    (close! [_]\n      (when close?\n        (p/close! read-ch)\n        (p/close! write-ch))\n      (when on-close\n        (on-close)))))\n\n(defn read-proxy-chan [read-ch on-close & [{:keys [close?] :or {close? true}}]]\n  (reify\n    p/ReadPort\n    (take! [_ handler]\n      (p/take! read-ch handler))\n\n    p/Channel\n    (close! [_]\n      (on-close)\n      (when close?\n        (p/close! read-ch)))))\n\n(defn pprint-str [x]\n  (str/trimr (with-out-str (pprint/pprint x))))\n\n(defn doc-examples! [vvar examples]\n  (alter-meta!\n   vvar update :doc str\n   \"\\n\\n```clojure\\n\"\n   (str/join\n    \"\\n\\n\"\n    (for [[before after] examples]\n      (cond-> (pprint-str before)\n        after (str \"\\n  =>\\n\" (pprint-str after)))))\n   \"\\n```\"))\n\n#? (:clj\n    (defmacro fn-when [[binding] & body]\n      `(fn [~binding]\n         (when ~binding\n           ~@body))))\n\n#? (:clj\n    (defmacro with-doc-examples! [vvar & examples]\n      `(doc-examples! #'~vvar (quote ~examples))))\n"]}