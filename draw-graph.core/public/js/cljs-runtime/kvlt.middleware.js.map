{"version":3,"sources":["kvlt/middleware.cljc"],"mappings":"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","names":["var_args","G__47053","kvlt.middleware/header","js/Error","p__47054","map__47057","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","hs","resp","k","and__4120__auto__","cljs.core/some","cljs.core/name","m","v","cljs.core.update.cljs$core$IFn$_invoke$arity$3","h","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$variadic","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","p__47072","map__47073","kvlt.middleware/body->string","body","kvlt.platform.util/byte-array->str","kvlt.middleware.util/charset","kvlt.middleware.header.cljs$core$IFn$_invoke$arity$2","js/kvlt","js/kvlt.middleware","js/kvlt.middleware.from-content-type","method-table__4613__auto__","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","prefer-table__4614__auto__","method-cache__4615__auto__","cached-hierarchy__4616__auto__","hierarchy__4617__auto__","cljs.core.get.cljs$core$IFn$_invoke$arity$3","fexpr__47082","cljs.core/MultiFn","cljs.core.symbol.cljs$core$IFn$_invoke$arity$2","kvlt.middleware/from-content-type","kvlt.middleware.util.__GT_content_type.cljs$core$IFn$_invoke$arity$1","cljs.core.keyword.cljs$core$IFn$_invoke$arity$1","cljs.reader.read_string.cljs$core$IFn$_invoke$arity$1","p__47092","map__47093","kvlt.platform.util/parse-json","kvlt.middleware/hint->body-type","x","cljs.core/Keyword","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/namespace","kvlt.middleware.util.__GT_mw.cljs$core$IFn$_invoke$arity$variadic","kvlt.middleware/body-type-hint","p__47099","map__47100","req","temp__5718__auto__","t","cljs.core/meta","cljs.core/keys","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","kvlt.util/doc-examples!","kvlt.middleware/content-type","p__47111","map__47112","type","character-encoding","map__47144","content-type","G__47145","G__47152","kvlt.middleware.header.cljs$core$IFn$_invoke$arity$3","kvlt.middleware.util.__GT_content_type.cljs$core$IFn$_invoke$arity$2","kvlt.middleware/accept","p__47162","map__47163","accept","kvlt.middleware/as-key","js/kvlt.middleware.as-type","fexpr__47168","kvlt.middleware/as-type","p__47169","map__47170","p__47173","map__47174","kvlt.platform.util/byte-array?","p__47181","map__47182","headers","G__47187","kvlt.middleware/parsing-error","e","error","kvlt.platform.util.exception__GT_map.cljs$core$IFn$_invoke$arity$variadic","G__47188","cljs.core/not","G__47189","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","p1__47190#","kvlt.middleware/as","e47191","kvlt.middleware/accept-encoding","p__47195","map__47196","cljs.core/coll?","clojure.string.join.cljs$core$IFn$_invoke$arity$2","cljs.core.map.cljs$core$IFn$_invoke$arity$2","kvlt.middleware/method","p__47201","map__47202","kvlt.middleware/port","p__47204","map__47205","port","kvlt.middleware/url","p__47210","map__47211","url","kvlt.middleware.util/parse-url","kvlt.middleware/default-content-type","G__47236","or__4131__auto__","G__47238","kvlt.middleware/keyword-headers","clojure.walk/stringify-keys","clojure.walk/keywordize-keys","p1__47239#","kvlt.middleware/lower-case","G__47240","clojure.string/lower-case","p1__47241#","p1__47242#","kvlt.middleware/lower-case-headers","kvlt.util/map-keys","kvlt.middleware/basic-auth","p__47243","map__47244","basic-auth","kvlt.middleware.util/basic-auth","kvlt.middleware/oauth-token","p__47246","map__47247","oauth-token","p1__47255#","kvlt.middleware/default-method","js/kvlt.middleware.decompress-body","fexpr__47256","kvlt.middleware/decompress-body","p__47257","map__47258","map__47259","kvlt.middleware/lift-content-encoding","content-encoding","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core/dissoc","p__47262","map__47263","kvlt.platform.util/gunzip","p__47272","map__47273","kvlt.platform.util/inflate","kvlt.middleware/decompress","G__47281","G__47283","kvlt.middleware/unexceptional-status?","kvlt.middleware/status->reason","kvlt.middleware/error","p__47284","map__47285","message","status","cause","reason","cljs.core.ex_info.cljs$core$IFn$_invoke$arity$3"],"sourcesContent":["(ns kvlt.middleware\n  (:require [#?(:clj clojure.edn :cljs cljs.reader) :as edn]\n            [kvlt.middleware.util :as util #? (:clj :refer :cljs :refer-macros) [defmw]]\n            [kvlt.util #? (:clj :refer :cljs :refer-macros) [with-doc-examples!]]\n            [kvlt.platform.util :as platform.util]\n            [clojure.set :as set]\n            [clojure.walk :as walk]\n            [clojure.string :as str]\n            [cats.core :as m]\n            [kvlt.util :refer [map-keys]]))\n\n(defn ^:no-doc header\n  ([{hs :headers :as resp} k]\n   (and hs (some hs [k (name k)])))\n  ([m k v]\n   (update m :headers\n           (fn [h]\n             (-> h\n                 (dissoc k (name k))\n                 (assoc (name k) v))))))\n\n(defn- body->string [{:keys [body] :as resp}]\n  (platform.util/byte-array->str\n   body (util/charset (header resp :content-type))))\n\n(defmulti from-content-type\n  \"Used by [[as]] to transform an incoming response.  Dispatches on\n  `:content-type`' header, as a namespace-qualified\n  keyword (e.g. `:application/edn`).  The input and output are the\n  top-level response map, not only the response body.\n\n  The default implementation (i.e. unrecognized content-type) returns\n  the response map unmodified.\"\n  (fn [resp]\n    (-> resp (header :content-type) util/->content-type keyword)))\n\n(defmethod from-content-type :default [resp]\n  resp)\n(defmethod from-content-type :application/edn [resp]\n  (assoc resp :body (edn/read-string (body->string resp))))\n(defmethod from-content-type :application/json [{:keys [body] :as resp}]\n  (assoc resp :body (platform.util/parse-json (body->string resp))))\n\n(defn- hint->body-type [x]\n  (when (and (keyword? x) (= \"kvlt.body\" (namespace x)))\n    (keyword (name x))))\n\n(defmw body-type-hint\n  \"Look for a body with a `:kvlt.body/`-prefixed metadata key, setting\n  the request's `:type` and `:form-params` keys\n  accordingly (e.g. `:body ^:kvlt/edn {:x 1}`)\"\n  ^{:has :body}\n  (fn [{:keys [body] :as req}]\n    (if-let [t (->> body meta keys (some hint->body-type))]\n      (-> req\n          (assoc  :type (keyword t) :form-params body)\n          (dissoc :body))\n      req)))\n\n(with-doc-examples! body-type-hint\n  [{:method :post\n    :body ^:kvlt.body/edn [1 2 3]}\n   {:method :post\n    :form-params [1 2 3]\n    :type :edn}])\n\n(defmw content-type\n  \"Turn request's `:content-type` (or `:type`), if any, and\n   `:character-encoding`, if any, into a \\\"content-type\\\" header & leave\n   top-level `:content-type` key in place. \"\n  (fn [{:keys [type body character-encoding] :as req}]\n    (let [{:keys [content-type] :as req}\n          (cond-> req type (assoc :content-type type))]\n      (cond-> req\n        content-type\n        (header :content-type\n                (util/->content-type content-type character-encoding))))))\n\n(with-doc-examples!\n  content-type\n  [{:content-type \"text/html\"\n    :character-encoding \"US-ASCII\"}\n   {:headers {:content-type \"text/html; charset=US-ASCII\"}\n    :content-type \"text/html\"}])\n\n(defmw accept\n  \"Turn request's `:accept` value, if any, into an \\\"accept\\\" header &\n  remove the top-level key.\"\n  ^{:has :accept :removing :accept}\n  (fn [{:keys [accept] :as req}]\n    (header req :accept (util/->content-type accept))))\n\n(with-doc-examples! accept\n  [{:accept :edn} {:headers {\"accept\" \"application/edn\"}}])\n\n(defn- as-key [resp]\n  (-> resp meta :kvlt/request :as))\n\n(defmulti ^:no-doc as-type as-key)\n(defmethod as-type :string [{:keys [body] :as resp}]\n  #? (:clj\n      (update resp :body platform.util/byte-array->str\n              (util/charset (header resp :content-type)))\n      :cljs resp))\n\n(defmethod as-type :byte-array [{:keys [body] :as resp}]\n  (assert\n   (platform.util/byte-array? body)\n   \"For platform-specific reasons, :as :byte-array is special-cased in\n  kvlt.platform.http/request\")\n  resp)\n(defmethod as-type :auto [resp] (from-content-type resp))\n(defmethod as-type :default [{:keys [headers] :as resp}]\n  (let [t    (header resp :content-type)\n        resp (assoc resp :orig-content-type t)]\n    (from-content-type\n     (header resp :content-type (util/->content-type (as-key resp))))))\n\n(defn- parsing-error [resp e]\n  (let [error (platform.util/exception->map\n               e {:error :middleware-error\n                  :type  :middleware-error})]\n    (cond-> resp\n      (not (resp :error)) (merge error))))\n\n(defmw as\n  \"Response body type conversion --- `:string` `:byte-array` `:auto` `:json` `:edn` etc..\n\n  See [[from-content-type]] for custom conversions.\"\n  #(merge {:as :string} %)\n  (fn [resp]\n    (try\n      (as-type resp)\n      (catch #? (:clj Exception :cljs js/Error) e\n        (parsing-error resp e)))))\n\n(defmw accept-encoding\n  \"Convert the `:accept-encoding` option (keyword/str, or collection of) to an\n  acceptable `Accept-Encoding` header.\n\n  This middleware is not likely to have any effect in a browser\n  environment.\"\n  ^{:has :accept-encoding :removing :accept-encoding}\n  (fn [{v :accept-encoding :as req}]\n    (header\n     req\n     :accept-encoding\n     (if (coll? v)\n       (str/join \", \" (map name v))\n       (name v)))))\n\n(with-doc-examples! accept-encoding\n  [{:accept-encoding :origami}\n   {:headers {:accept-encoding \"origami\"}}]\n  [{:accept-encoding [:a :b]}\n   {:headers {:accept-encoding \"a, b\"}}])\n\n(defmw method\n  \"Rename request's `:method` key to `:request-method`\"\n  ^{:has :method :removing :method}\n  (fn [{m :method :as req}]\n    (assoc req :request-method m)))\n\n(defmw port\n  \"Rename request's `:port` key to `:server-port`\"\n  ^{:has :port :removing :port}\n  (fn [{port :port :as req}]\n    (assoc req :server-port port)))\n\n(with-doc-examples! method\n  [{:method :get} {:request-method :get}])\n\n(defmw url\n  \"Turn request's `:url` value, if any, into top-level `:scheme`,\n  `:server-name`, `:server-port`, `:uri`, `:query-string`, and\n  `:user-info` keys\"\n  ^{:has :url :removing :url}\n  (fn [{url :url :as req}]\n    (merge req (util/parse-url url))))\n\n(with-doc-examples! url\n  [{:url \"ftp://localhost:9/x?x=1\"}\n   {:scheme :ftp\n    :server-name \"localhost\"\n    :server-port 9\n    :uri \"/x\"\n    :user-info nil\n    :query-string \"x=1\"}])\n\n(defmw default-content-type\n  \"Add `:content-type` key having value `:text/plain`, if no `:content-type` present.\n\n  Assumes placement before [[content-type]].\"\n  (fn [req]\n    (if (and (req :body) (not (or (req :content-type) (header req :content-type))))\n      (assoc req :content-type :text/plain)\n      req)))\n\n(defmw keyword-headers\n  \"Convert keys within request's `:headers` value to strings, and\nresponse's `:headers` values to keywords. \"\n  [:headers walk/stringify-keys]\n  [:headers walk/keywordize-keys])\n\n(def ^:private lower-case\n  #(cond-> (str/lower-case (name %)) (keyword? %) keyword))\n\n(defmw lower-case-headers\n  \"Convert keys within request & response's `:headers` value to lower\n  case.\"\n  [:headers #(map-keys lower-case %)]\n  [:headers #(map-keys lower-case %)])\n\n(defmw basic-auth\n  \"Convert `:basic-auth` values (vector or map) into an\n `:authorization` header.\"\n  ^{:has :basic-auth :removing :basic-auth}\n  (fn [{:keys [basic-auth] :as req}]\n    (header req :authorization (util/basic-auth basic-auth))))\n\n(with-doc-examples! basic-auth\n  [{:basic-auth [\"user\" \"pass\"]} {:headers {:authorization \"Basic ...\"}}]\n  [{:basic-auth {:username \"user\" :password \"pass\"}}\n   {:headers {:authorization \"Basic ...\"}}])\n\n(defmw oauth-token\n  \"Convert `:oauth-token` value into an `:authorization` header\"\n  ^{:has :oauth-token :removing :oauth-token}\n  (fn [{:keys [oauth-token] :as req}]\n    (header req :authorization (str \"Bearer \" oauth-token))))\n\n(with-doc-examples! oauth-token\n  [{:oauth-token \"xyz\"} {:headers {:authorization \"Bearer xyz\"}}])\n\n(defmw default-method\n  \"Merge request map with `{:method :get}`.\n\n  Assumes placement before [[method]].\"\n  #(merge {:method :get} %))\n\n(with-doc-examples! default-method\n  [{} {:method :get}])\n\n(defmulti decompress-body\n  \"Dispatch on the response's `:content-encoding` header value.\n  Clojure implementations exist for \\\"gzip\\\" and \\\"deflate\\\".\"\n  (fn [resp]\n    (and (:body resp) (header resp :content-encoding))))\n\n(defn ^:no-doc lift-content-encoding [{{:strs [content-encoding]} :headers :as resp}]\n  (-> resp\n      (assoc :orig-content-encoding content-encoding)\n      (update :headers dissoc \"content-encoding\")))\n\n(defmethod decompress-body \"gzip\" [{:keys [body] :as resp}]\n  (let [body (platform.util/gunzip body)]\n    (lift-content-encoding (assoc resp :body body))))\n\n(defmethod decompress-body \"deflate\" [{:keys [body] :as resp}]\n  (let [body (platform.util/inflate body)]\n    (lift-content-encoding (assoc resp :body body))))\n\n(defmethod decompress-body :default [resp]\n  (lift-content-encoding resp))\n\n(defmw decompress\n  \"Response body decompression.  Defaults request's \\\"Accept-Encoding\\\" header.\n  Can be disabled per-request via `:decompress-body? false'\"\n  ^{:removing :accept-encoding}\n  (fn [req]\n    (cond-> req\n      (and (not (false? (req :decompress-body?)))\n           (not (header req :accept-encoding)))\n      (header :accept-encoding \"gzip, deflate\")))\n  (fn [resp]\n    #? (:clj  (let [decomp? (-> resp meta :kvlt/request :decompress-body? false? not)]\n                (cond-> resp (and decomp? (not-empty (resp :body))) decompress-body))\n        :cljs resp)))\n\n(def ^:no-doc unexceptional-status?\n  #{200 201 202 203 204 205 206 207 300 301 302 303 304 307})\n\n(def ^:no-doc status->reason\n  {100 :continue\n   101 :switching-protocols\n   200 :ok\n   201 :created\n   202 :accepted\n   203 :non-authoritative-information\n   204 :no-content\n   205 :reset-content\n   206 :partial-content\n   300 :multiple-choices\n   301 :moved-permanently\n   302 :found\n   303 :see-other\n   304 :not-modified\n   305 :use-proxy\n   307 :temporary-redirect\n   400 :bad-request\n   401 :unauthorized\n   402 :payment-required ;; serious business\n   403 :forbidden\n   404 :not-found\n   405 :method-not-allowed\n   406 :not-acceptable\n   407 :proxy-authentication-required\n   408 :request-timeout\n   409 :conflict\n   410 :gone\n   411 :length-required\n   412 :precondition-failed\n   413 :request-entity-too-large\n   414 :request-uri-too-large\n   415 :unsupported-media-type\n   416 :requested-range-not-satisfiable\n   417 :expectation-failed\n   500 :internal-server-error\n   501 :not-implemented\n   502 :bad-gateway\n   503 :service-unavailable\n   504 :gateway-timeout\n   505 :http-version-not-supported})\n\n(defmw error\n  \"Turn error responses into `ExceptionInfo` instances, with the full\n  response map as the attached data.  Additionally, a `:reason`\n  value (e.g. `:service-unavailable`) will be used to augment the\n  `:status` key.\n\n  For uniformity, `:type` is provided as an alias for `:reason`, e.g.\"\n  nil\n  (fn [{:keys [message status cause error] :as resp}]\n    (let [reason (status->reason status error)]\n      (if (and (not error) (unexceptional-status? status))\n        (assoc resp :reason reason)\n        (ex-info message\n                 (assoc resp\n                   :error  (or error reason)\n                   :type   reason\n                   :reason reason)\n                 cause)))))\n\n(with-doc-examples! error\n  [{:status  500\n    :reason  :internal-server-error\n    :type    :internal-server-error\n    :cause   error?\n    :headers ...}])\n"]}